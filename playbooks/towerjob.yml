---
- name: Create AWX Job Template
  hosts: localhost
  connection: local
  gather_facts: no

  vars:
    #awx_api_url: "https://your-awx-instance.com/api/v2/"
    #awx_api_token: "your-awx-api-token"
    #awx_api_url: "http://18.132.71.223:30080/api/v2/"
    awx_api_url: "http://18.132.71.223:30080/"
    awx_api_token: "rVL5feaTFv28hX518kRW50ob0eyvXp"

  tasks:
    - name: Create Credential
      awx.awx.credential:
        name: "My Credential"
        description: "This is my AWX credential"
        credential_type: Machine
        inputs:
          username: "my-username"
          password: "my-password"
        state: "present"
        validate_certs: false
        controller_host: "{{ awx_api_url }}"
        controller_oauthtoken: "{{ awx_api_token }}"
        organization: ''
        user: admin

    - name: Create Project
      tower_project:
        name: "My AWX Project"
        description: "This is my AWX project"
        scm_type: "git"
        scm_url: "https://github.com/sirkubax/akademiaansible.git"
        scm_branch: "master"
        #scm_credential: "Demo Credential"
        wait: true
        state: "present"
        #awx_host: "{{ awx_api_url }}"
        #awx_username: "admin"
        #awx_password: "4TNeHG5jnWc64CsK63CqHycDNgletUZ4"
        #awx_validate_certs: false
        validate_certs: false
        controller_host: "{{ awx_api_url }}"
        controller_oauthtoken: "{{ awx_api_token }}"
      register: project

    - name: Create Job Template
      tower_job_template:
        name: "My AWX Job Template"
        description: "This is my AWX Job Template"
        job_type: "run"
        inventory: "Demo Inventory"
        project: "My AWX Project"
        playbook: "playbooks/simple_playbook.yml"
        credential: "My Credential"
        #extra_vars: |
        #  my_var: "my_value"
        allow_simultaneous: true
        limit: "my-host"
        #extra_data:
        #  webhook_credential: "My Webhook Credential"
        controller_host: "{{ awx_api_url }}"
        #controller_host: "http://18.132.71.223"
        controller_oauthtoken: "{{ awx_api_token }}"
      delegate_to: localhost


# awx_host, awx_password, awx_username, awx_validate_certs. Supported parameters incl
#ude: credential (scm_credential), scm_branch, wait, scm_url, scm_track_submodules, controller_host (tower_host), scm_type, notification_templates_
#started, allow_override (scm_allow_override), validate_certs (tower_verify_ssl), controller_oauthtoken (tower_oauthtoken), local_path, controller_
#config_file (tower_config_file), controller_password (tower_password), scm_update_cache_timeout, update_project, interval, description, name, noti
#fication_templates_success, notification_templates_error, scm_clean, state, scm_delete_on_update, copy_from, scm_update_on_launch, controller_user
#name (tower_username), timeout (job_timeout), scm_refspec, custom_virtualenv, default_environment, organization
